{% extends 'base.html' %}
{% block content %}

<style>
/* Root Variables for Consistent Theming */
:root {
  --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  --glass-bg: rgba(255, 255, 255, 0.95);
  --glass-border: rgba(255, 255, 255, 0.2);
  --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.07);
  --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.1);
  --shadow-heavy: 0 20px 40px rgba(0, 0, 0, 0.15);
  --border-radius: 15px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Enhanced Admin Dashboard Background */
.admin-dashboard {
  background: var(--primary-gradient);
  min-height: 100vh;
  padding: 20px 0;
  position: relative;
  overflow-x: hidden;
}

.admin-dashboard::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.08)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
  opacity: 0.1;
  pointer-events: none;
}

/* Enhanced Dashboard Header */
.dashboard-header {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 30px;
  margin-bottom: 30px;
  box-shadow: var(--shadow-medium);
  position: relative;
  overflow: hidden;
  animation: slideInUp 0.6s ease-out;
}

.dashboard-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  animation: shimmer 2s infinite;
}

/* Stats Cards Enhancement */
.stats-card {
  background: var(--primary-gradient);
  border: none;
  border-radius: var(--border-radius);
  color: white;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  cursor: pointer;
  animation: fadeInScale 0.6s ease-out forwards;
  opacity: 0;
  transform: scale(0.9);
}

.stats-card:nth-child(1) { animation-delay: 0.1s; }
.stats-card:nth-child(2) { animation-delay: 0.2s; }
.stats-card:nth-child(3) { animation-delay: 0.3s; }
.stats-card:nth-child(4) { animation-delay: 0.4s; }
.stats-card:nth-child(5) { animation-delay: 0.5s; }

.stats-card::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
  transform: rotate(45deg);
  transition: var(--transition);
  opacity: 0;
}

.stats-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: var(--shadow-heavy);
}

.stats-card:hover::before {
  opacity: 1;
  animation: slideAcross 0.6s ease-out;
}

.stats-card .card-body {
  padding: 25px;
  position: relative;
  z-index: 2;
}

.stats-card .display-4 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 5px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.stats-card h6 {
  font-weight: 600;
  margin-bottom: 10px;
  opacity: 0.9;
}

.stats-card small {
  opacity: 0.8;
  font-weight: 500;
}

/* Enhanced Navigation Tabs */
.nav-tabs {
  border: none;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: var(--border-radius) var(--border-radius) 0 0;
  padding: 10px;
  margin-bottom: 0;
  box-shadow: var(--shadow-light);
}

.nav-tabs .nav-link {
  border: none;
  border-radius: 10px;
  color: black;
  font-weight: 600;
  padding: 15px 25px;
  margin-right: 5px;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.nav-tabs .nav-link::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s;
}

.nav-tabs .nav-link:hover::before {
  left: 100%;
}

.nav-tabs .nav-link.active {
  background: var(--primary-gradient);
  color: rgb(20, 44, 199);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  transform: translateY(-2px);
}

.nav-tabs .nav-link i {
  margin-right: 8px;
  font-size: 1.1em;
}

/* Enhanced Tab Content */
.tab-content {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 0 var(--border-radius) var(--border-radius) var(--border-radius);
  padding: 30px;
  box-shadow: var(--shadow-medium);
  margin-top: 0;
  position: relative;
  animation: fadeIn 0.4s ease-out;
}

/* Enhanced Form Cards */
.form-card {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 25px;
  margin-bottom: 20px;
  box-shadow: var(--shadow-light);
  transition: var(--transition);
}

.form-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium);
}

/* Enhanced Tables */
.table-modern {
  border-radius: var(--border-radius);
  overflow: hidden;
  box-shadow: var(--shadow-light);
  background: white;
}

.table-modern thead th {
  background: var(--primary-gradient);
  color: white;
  border: none;
  font-weight: 600;
  padding: 15px;
  position: relative;
}

.table-modern thead th::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background: rgba(255,255,255,0.3);
}

.table-modern tbody tr {
  transition: var(--transition);
  border-bottom: 1px solid rgba(0,0,0,0.05);
}

.table-modern tbody tr:hover {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
  transform: scale(1.01);
}

.table-modern tbody tr:last-child {
  border-bottom: none;
}

/* Enhanced Buttons */
.btn-modern {
  border-radius: 25px;
  padding: 10px 25px;
  font-weight: 600;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  border: none;
}

.btn-modern::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn-modern:hover::before {
  width: 300px;
  height: 300px;
}

.btn-modern:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.btn-modern span {
  position: relative;
  z-index: 2;
}

/* Enhanced Search Box */
.search-box {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: 25px;
  padding: 15px 25px;
  box-shadow: var(--shadow-light);
  margin-bottom: 20px;
  transition: var(--transition);
}

.search-box:hover {
  box-shadow: var(--shadow-medium);
  transform: translateY(-1px);
}

.search-box .input-group-text {
  background: transparent;
  border: none;
  color: #667eea;
}

/* Enhanced Offer Cards */
.offer-card {
  background: var(--secondary-gradient);
  border: none;
  border-radius: var(--border-radius);
  color: white;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.offer-card::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  border-radius: 50%;
  transform: scale(0);
  transition: transform 0.5s;
}

.offer-card:hover::before {
  transform: scale(2);
}

.offer-card:hover {
  transform: translateY(-5px) rotate(1deg);
  box-shadow: var(--shadow-heavy);
}

/* Enhanced Medicine Cards */
.medicine-card {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-light);
  height: 100%;
}

.medicine-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
  transition: left 0.5s;
}

.medicine-card:hover::before {
  left: 100%;
}

.medicine-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: var(--shadow-heavy);
}

.medicine-card .card-img-top {
  height: 180px;
  object-fit: cover;
  border-radius: var(--border-radius) var(--border-radius) 0 0;
  transition: var(--transition);
}

.medicine-card:hover .card-img-top {
  transform: scale(1.05);
}

.medicine-card .card-body {
  padding: 20px;
  position: relative;
  z-index: 2;
}

.medicine-card .card-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #333;
  margin-bottom: 15px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.medicine-card .medicine-info {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  font-size: 0.85rem;
  margin-bottom: 15px;
}

.medicine-card .medicine-info div {
  display: flex;
  flex-direction: column;
}

.medicine-card .medicine-info small {
  color: #666;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
}

.medicine-card .medicine-info span {
  font-weight: 500;
  color: #333;
}

.medicine-card .price-section {
  margin-bottom: 15px;
}

.medicine-card .price-section .original-price {
  text-decoration: line-through;
  color: #999;
  font-size: 0.9rem;
}

.medicine-card .price-section .discounted-price {
  color: #28a745;
  font-weight: 700;
  font-size: 1.1rem;
}

.medicine-card .stock-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 3;
  font-size: 0.75rem;
  padding: 4px 8px;
  border-radius: 12px;
  font-weight: 600;
}

.medicine-card .stock-badge.in-stock {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
}

.medicine-card .stock-badge.low-stock {
  background: linear-gradient(135deg, #ffc107, #fd7e14);
  color: white;
}

.medicine-card .stock-badge.out-of-stock {
  background: linear-gradient(135deg, #dc3545, #e83e8c);
  color: white;
}

.medicine-card .card-actions {
  display: flex;
  gap: 8px;
  margin-top: auto;
}

.medicine-card .btn {
  flex: 1;
  font-size: 0.8rem;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 600;
  transition: var(--transition);
}

.medicine-card .btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Medicine Filters and Controls */
.medicine-controls {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border: 1px solid #e2e8f0;
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 32px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
  position: relative;
  overflow: hidden;
}

.medicine-controls::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #3b82f6, #1d4ed8, #1e40af);
  border-radius: 16px 16px 0 0;
}

.medicine-controls .row {
  align-items: end;
  position: relative;
  z-index: 1;
}

.medicine-controls .form-label {
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 12px;
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  display: block;
}

.medicine-controls .form-select,
.medicine-controls .form-control {
  border-radius: 12px;
  border: 2px solid #e5e7eb;
  padding: 14px 16px;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  background-color: #ffffff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  color: #374151;
}

.medicine-controls .form-select:focus,
.medicine-controls .form-control:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 4px 8px rgba(0, 0, 0, 0.12);
  outline: none;
  background-color: #ffffff;
  transform: translateY(-1px);
}

.medicine-controls .form-select:hover,
.medicine-controls .form-control:hover {
  border-color: #9ca3af;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

/* Bulk Actions */
.bulk-actions {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 15px;
  margin-top: 20px;
  box-shadow: var(--shadow-light);
  display: none; /* Hidden by default, shown when items selected */
}

.bulk-actions.show {
  display: block;
}

.bulk-actions .btn {
  margin-right: 10px;
  border-radius: 20px;
  font-weight: 600;
}

/* Checkbox Styling */
.medicine-checkbox {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 3;
  width: 20px;
  height: 20px;
  opacity: 0;
  cursor: pointer;
}

.medicine-checkbox + label {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 4;
  width: 20px;
  height: 20px;
  background: rgba(255,255,255,0.9);
  border: 2px solid #667eea;
  border-radius: 4px;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
}

.medicine-checkbox:checked + label {
  background: #667eea;
  border-color: #667eea;
}

.medicine-checkbox:checked + label::after {
  content: '✓';
  color: white;
  font-size: 12px;
  font-weight: bold;
}

/* Responsive Enhancements for Medicine Tab */
@media (max-width: 768px) {
  .medicine-card .medicine-info {
    grid-template-columns: 1fr;
  }

  .medicine-controls .col-md-3 {
    margin-bottom: 15px;
  }

  .medicine-card .card-actions {
    flex-direction: column;
  }

  .medicine-card .btn {
    margin-bottom: 5px;
  }
}

/* Enhanced Chart Containers */
.chart-container {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 25px;
  box-shadow: var(--shadow-light);
  margin-bottom: 20px;
  transition: var(--transition);
}

.chart-container:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium);
}

/* Enhanced Modals */
.modal-content {
  border-radius: var(--border-radius);
  border: none;
  box-shadow: var(--shadow-heavy);
  backdrop-filter: blur(20px);
  background: var(--glass-bg);
}

.modal-header {
  border-bottom: 1px solid var(--glass-border);
  border-radius: var(--border-radius) var(--border-radius) 0 0;
  background: var(--primary-gradient);
  color: white;
}

.modal-header .btn-close {
  filter: invert(1);
}

.modal-body {
  padding: 30px;
}

.modal-footer {
  border-top: 1px solid var(--glass-border);
  border-radius: 0 0 var(--border-radius) var(--border-radius);
}

/* Loading Animation */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.loading {
  animation: pulse 1.5s infinite;
}

/* Slide In Animation */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Fade In Scale Animation */
@keyframes fadeInScale {
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Shimmer Effect */
@keyframes shimmer {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* Slide Across Effect */
@keyframes slideAcross {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* Fade In Animation */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Responsive Enhancements */
@media (max-width: 768px) {
  .admin-dashboard {
    padding: 10px 0;
  }

  .dashboard-header {
    padding: 20px;
    margin-bottom: 20px;
  }

  .stats-card .display-4 {
    font-size: 2rem;
  }

  .nav-tabs .nav-link {
    padding: 10px 15px;
    font-size: 0.9rem;
  }

  .tab-content {
    padding: 20px;
  }

  .form-card {
    padding: 20px;
  }

  .table-responsive {
    font-size: 0.9rem;
  }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--primary-gradient);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
}

/* Tooltip Enhancements */
.tooltip-inner {
  background: var(--primary-gradient);
  border-radius: 8px;
  font-weight: 500;
}

/* Focus States */
.form-control:focus,
.form-select:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  transform: scale(1.02);
  transition: var(--transition);
}

/* Badge Enhancements */
.badge {
  font-weight: 600;
  padding: 6px 12px;
  border-radius: 20px;
  transition: var(--transition);
}

.badge:hover {
  transform: scale(1.05);
}

/* Card Hover Effects */
.card {
  transition: var(--transition);
}

.card:hover {
  transform: translateY(-2px);
}

/* Enhanced Dropdowns */
.dropdown-menu {
  border-radius: var(--border-radius);
  border: none;
  box-shadow: var(--shadow-medium);
  backdrop-filter: blur(10px);
  background: var(--glass-bg);
}

.dropdown-item {
  transition: var(--transition);
  border-radius: 8px;
  margin: 2px 5px;
}

.dropdown-item:hover {
  background: var(--primary-gradient);
  color: white;
  transform: translateX(5px);
}

/* Halloween Theme for October 26 */
.halloween {
  --primary-gradient: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
  --secondary-gradient: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%);
  --success-gradient: linear-gradient(135deg, #ff9500 0%, #ff6b35 100%);
  --warning-gradient: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
  --danger-gradient: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%);
  --glass-bg: rgba(0, 0, 0, 0.8);
  --glass-border: rgba(255, 165, 0, 0.3);
  --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.5);
  --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.6);
  --shadow-heavy: 0 20px 40px rgba(0, 0, 0, 0.7);
  --border-radius: 15px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.halloween .admin-dashboard {
  background: linear-gradient(135deg, #2d1b69 0%, #11998e 50%, #ff6b35 100%);
}

.halloween .dashboard-header {
  background: var(--glass-bg);
  color: #ff6b35;
}

.halloween .stats-card {
  background: var(--primary-gradient);
  color: white;
}

.halloween .nav-tabs .nav-link.active {
  background: var(--primary-gradient);
  color: white;
}

.halloween .tab-content {
  background: var(--glass-bg);
}

.halloween .form-card {
  background: var(--glass-bg);
}

.halloween .table-modern thead th {
  background: var(--primary-gradient);
}

.halloween .btn-modern {
  background: var(--primary-gradient);
}

.halloween .offer-card {
  background: var(--secondary-gradient);
}

.halloween .medicine-card {
  background: var(--glass-bg);
}

.halloween .chart-container {
  background: var(--glass-bg);
}

.halloween .modal-content {
  background: var(--glass-bg);
}

.halloween .badge {
  background: var(--primary-gradient);
}
</style>

<div class="admin-dashboard">
  <div class="container-fluid">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h1 class="mb-2"><i class="fas fa-tachometer-alt text-primary"></i> Admin Dashboard</h1>
          <p class="text-muted mb-0">Welcome back! Here's what's happening with your pharmacy today.</p>
        </div>
        <div class="col-md-6 text-end">
          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-outline-primary btn-modern" onclick="window.print()">
              <i class="fas fa-print"></i> Export Report
            </button>
            <button class="btn btn-primary btn-modern" onclick="location.reload()">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
          <div class="card-body text-center">
            <i class="fas fa-pills fa-2x mb-3 opacity-75"></i>
            <h6 class="card-title">Total Medicines</h6>
            <p class="card-text display-4 mb-0">{{ total_meds }}</p>
            <small class="opacity-75">In inventory</small>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
          <div class="card-body text-center">
            <i class="fas fa-shopping-cart fa-2x mb-3 opacity-75"></i>
            <h6 class="card-title">Total Orders</h6>
            <p class="card-text display-4 mb-0">{{ total_orders }}</p>
            <small class="opacity-75">All time</small>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
          <div class="card-body text-center">
            <i class="fas fa-users fa-2x mb-3 opacity-75"></i>
            <h6 class="card-title">Total Users</h6>
            <p class="card-text display-4 mb-0">{{ total_users }}</p>
            <small class="opacity-75">Registered</small>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
          <div class="card-body text-center">
            <i class="fas fa-clock fa-2x mb-3 opacity-75"></i>
            <h6 class="card-title">Pending Orders</h6>
            <p class="card-text display-4 mb-0">{{ pending_orders }}</p>
            <small class="opacity-75">Need attention</small>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
          <div class="card-body text-center">
            <i class="fas fa-file-prescription fa-2x mb-3 opacity-75"></i>
            <h6 class="card-title">Total Prescriptions</h6>
            <p class="card-text display-4 mb-0">{{ total_prescriptions }}</p>
            <small class="opacity-75">All prescriptions</small>
          </div>
        </div>
      </div>
    </div>

<!-- Navigation Tabs -->
        <!-- Navigation Tabs -->
    <ul class="nav nav-tabs" id="adminTab" role="tablist">
<li class="nav-item" role="presentation">
<button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab" aria-controls="dashboard" aria-selected="true">
  <i class="fas fa-tachometer-alt"></i> Dashboard
</button>
   </li>
<li class="nav-item" role="presentation">
      <button class="nav-link" id="medicines-tab" data-bs-toggle="tab" data-bs-target="#medicines" type="button" role="tab" aria-controls="medicines" aria-selected="false">
        <i class="fas fa-pills"></i> Medicines
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab" aria-controls="orders" aria-selected="false">
          <i class="fas fa-shopping-cart"></i> Orders
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="offers-tab" data-bs-toggle="tab" data-bs-target="#offers" type="button" role="tab" aria-controls="offers" aria-selected="false">
<i class="fas fa-tags"></i> Offers
       </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="prescriptions-tab" data-bs-toggle="tab" data-bs-target="#prescriptions" type="button" role="tab" aria-controls="prescriptions" aria-selected="false">
          <i class="fas fa-file-prescription"></i> Prescriptions
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="false">
          <i class="fas fa-users"></i> Users
       </button>
      </li>
    </ul>
    

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Dashboard Tab -->
      <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
        <div class="section-container mb-4">
          <h4 class="section-title mb-4"><i class="fas fa-tachometer-alt text-primary"></i> Dashboard Overview</h4>
          <div class="row">
            <div class="col-lg-8">
              <div class="chart-container">
                <h5 class="mb-3"><i class="fas fa-chart-bar text-primary"></i> Sales by Order Status</h5>
                <canvas id="salesChart" width="400" height="200"></canvas>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="chart-container">
                <h5 class="mb-4"><i class="fas fa-pie-chart text-success"></i> Order Status Distribution</h5>
                <canvas id="orderStatusChart" width="200" height="200"></canvas>
              </div>
            </div>
          </div>
          <!-- Pending Prescriptions Section -->
          <div class="row mt-4">
            <div class="col-12">
              <div class="chart-container">
                <h5 class="mb-3"><i class="fas fa-file-prescription text-warning"></i> Pending Prescriptions</h5>
                {% if pending_prescriptions %}
                <div class="table-responsive">
                  <table class="table table-modern">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Patient</th>
                        <th>Doctor</th>
                        <th>Medicine</th>
                        <th>Dosage</th>
                        <th>Date</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for prescription in pending_prescriptions %}
                      <tr>
                        <td>{{ prescription.id }}</td>
                        <td>{{ prescription.user.email }}</td>
                        <td>{{ prescription.doctor.email if prescription.doctor else 'N/A' }}</td>
                        <td>{{ prescription.medicine or 'N/A' }}</td>
                        <td>{{ prescription.dosage or 'N/A' }}</td>
                        <td>{{ prescription.submitted_at.strftime('%Y-%m-%d') }}</td>
                        <td>
                          <form method="POST" action="{{ url_for('admin.admin_verify', prescription_id=prescription.id) }}" style="display:inline;">
                            <input type="hidden" name="action" value="approve">
                            <button type="submit" class="btn btn-success btn-sm me-1">Approve</button>
                          </form>
                          <form method="POST" action="{{ url_for('admin.admin_verify', prescription_id=prescription.id) }}" style="display:inline;">
                            <input type="hidden" name="action" value="reject">
                            <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                          </form>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                {% else %}
                <p class="text-muted">No pending prescriptions.</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Medicines Tab -->
      <div class="tab-pane fade" id="medicines" role="tabpanel">
                <div class="row">
          <div class="col-lg-4">
            <div class="form-card">
              <h5 class="mb-4"><i class="fas fa-plus-circle text-success"></i> Add New Medicine</h5>
              <form method="POST" action="{{ url_for('admin.admin_dashboard') }}" enctype="multipart/form-data" id="addMedicineForm">
                <div class="mb-3">
                  <label class="form-label">Medicine Name</label>
                  <input type="text" name="medicine_name" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Brand Name</label>
                  <input type="text" name="name" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Type</label>
                  <input type="text" name="type" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Age Group</label>
                  <input type="text" name="age_group" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Category</label>
                  <select name="category" class="form-control" required>
                    <option value="">Select Category</option>
                    <option value="Allopathy">Allopathy</option>
                    <option value="Ayurvedic">Ayurvedic</option>
                    <option value="Homeopathy">Homeopathy</option>
                    <option value="Beauty">Beauty</option>
                    <option value="Skin & Hair Care">Skin & Hair Care</option>
                    <option value="Baby Care">Baby Care</option>
                    <option value="Diabetes Care">Diabetes Care</option>
                    <option value="Cardiac Care">Cardiac Care</option>
                    <option value="Liver Care">Liver Care</option>
                    <option value="Respiratory">Respiratory</option>
                    <option value="Supplements">Supplements</option>
                    <option value="Fitness & Wellness">Fitness & Wellness</option>
                    <option value="Women's Health">Women's Health</option>
                    <option value="Men's Health">Men's Health</option>
                    <option value="Oral Care">Oral Care</option>
                    <option value="Personal Hygiene">Personal Hygiene</option>
                    <option value="Pain Relief">Pain Relief</option>
                    <option value="ENT Care">ENT Care</option>
                    <option value="First Aid">First Aid</option>
                    <option value="Surgical Supplies">Surgical Supplies</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Price (₹)</label>
                  <input type="number" step="0.01" name="price" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Discount (% OFF)</label>
                  <input type="number" name="discount" class="form-control" min="0" max="100">
                </div>
                <div class="mb-3">
                  <label class="form-label">Stock</label>
                  <input type="number" name="stock" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Image</label>
                  <input type="file" name="image" class="form-control" accept="image/*">
                </div>
                <div class="mb-3">
                  <label class="form-label">Description</label>
                  <textarea name="description" class="form-control" rows="3"></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Ingredients</label>
                  <textarea name="ingredients" class="form-control" rows="3"></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Usage</label>
                  <textarea name="usage" class="form-control" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Add Medicine</button>
              </form>
            </div>
          </div>
          <div class="col-lg-8">
            <!-- Filters and Controls -->
            <div class="medicine-controls">
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Search</label>
                  <input type="text" class="form-control" placeholder="Search medicines..." id="medicineSearch">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Category</label>
                  <select class="form-select" id="categoryFilter">
                    <option value="">All Categories</option>
                    <option value="Allopathy">Allopathy</option>
                    <option value="Ayurvedic">Ayurvedic</option>
                    <option value="Homeopathy">Homeopathy</option>
                    <option value="Beauty">Beauty</option>
                    <option value="Skin & Hair Care">Skin & Hair Care</option>
                    <option value="Baby Care">Baby Care</option>
                    <option value="Diabetes Care">Diabetes Care</option>
                    <option value="Cardiac Care">Cardiac Care</option>
                    <option value="Liver Care">Liver Care</option>
                    <option value="Respiratory">Respiratory</option>
                    <option value="Supplements">Supplements</option>
                    <option value="Fitness & Wellness">Fitness & Wellness</option>
                    <option value="Women's Health">Women's Health</option>
                    <option value="Men's Health">Men's Health</option>
                    <option value="Oral Care">Oral Care</option>
                    <option value="Personal Hygiene">Personal Hygiene</option>
                    <option value="Pain Relief">Pain Relief</option>
                    <option value="ENT Care">ENT Care</option>
                    <option value="First Aid">First Aid</option>
                    <option value="Surgical Supplies">Surgical Supplies</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Stock Status</label>
                  <select class="form-select" id="stockFilter">
                    <option value="">All Stock</option>
                    <option value="in-stock">In Stock (>10)</option>
                    <option value="low-stock">Low Stock (1-10)</option>
                    <option value="out-of-stock">Out of Stock (0)</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Sort By</label>
                  <select class="form-select" id="sortBy">
                    <option value="name">Name</option>
                    <option value="price">Price</option>
                    <option value="stock">Stock</option>
                    <option value="category">Category</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulkActions" style="display: none;">
              <div class="d-flex justify-content-between align-items-center">
                <span id="selectedCount">0 medicines selected</span>
                <div>
                  <button class="btn btn-outline-danger btn-sm me-2" onclick="bulkDelete()">Delete Selected</button>
                  <button class="btn btn-outline-primary btn-sm" onclick="bulkExport()">Export Selected</button>
                </div>
              </div>
            </div>

            <div class="row" id="medicinesGrid">
              {% for medicine in medicines %}
              <div class="col-md-6 col-lg-4 mb-4 medicine-item" data-category="{{ medicine.medicine.category|tojson }}" data-stock="{{ medicine.medicine.stock }}" data-name="{{ medicine.medicine.name|tojson }}" data-price="{{ medicine.medicine.price }}">
                <div class="card h-100 border">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <input type="checkbox" class="medicine-checkbox" onchange="toggleBulkActions()">
                    <span class="badge {% if medicine.medicine.stock > 10 %}bg-success{% elif medicine.medicine.stock > 0 %}bg-warning{% else %}bg-danger{% endif %}">{{ medicine.medicine.stock }} units</span>
                  </div>
                  {% if medicine.medicine.image %}
                  <img src="{{ medicine.medicine.image }}" class="card-img-top" alt="{{ medicine.medicine.name }}" style="height: 150px; object-fit: cover;">
                  {% endif %}
                  <div class="card-body">
                    <h6 class="card-title">{{ medicine.medicine.name }}</h6>
                    <p class="card-text small text-muted">{{ medicine.medicine.medicine_name }}</p>
                    <p class="card-text"><strong>Type:</strong> {{ medicine.medicine.type }}</p>
                    <p class="card-text"><strong>Category:</strong> {{ medicine.medicine.category }}</p>
                    <p class="card-text"><strong>Age Group:</strong> {{ medicine.medicine.age_group }}</p>
                    <p class="card-text">
                      <strong>Price:</strong>
                      {% if medicine.medicine.discount > 0 %}
                        <span class="text-decoration-line-through">₹{{ "%.2f"|format(medicine.medicine.price) }}</span>
                        ₹{{ "%.2f"|format(medicine.discounted_price) }}
                      {% else %}
                        ₹{{ "%.2f"|format(medicine.medicine.price) }}
                      {% endif %}
                    </p>
                    {% if medicine.medicine.discount > 0 %}
                    <p class="card-text"><strong>Discount:</strong> {{ medicine.medicine.discount }}%</p>
                    {% endif %}
                    <p class="card-text small">{{ medicine.medicine.description|truncate(100) }}</p>
                  </div>
                  <div class="card-footer">
                    <div class="btn-group w-100">
                      <button class="btn btn-outline-info btn-sm" onclick="openViewModal(this)" data-id="{{ medicine.medicine.id }}" data-medicine_name="{{ medicine.medicine.medicine_name|tojson }}" data-name="{{ medicine.medicine.name|tojson }}" data-type="{{ medicine.medicine.type|tojson }}" data-age_group="{{ medicine.medicine.age_group|tojson }}" data-category="{{ medicine.medicine.category|tojson }}" data-price="{{ medicine.medicine.price }}" data-discount="{{ medicine.medicine.discount }}" data-stock="{{ medicine.medicine.stock }}" data-description="{{ medicine.medicine.description|tojson }}" data-image="{{ medicine.medicine.image|tojson }}">
                        <i class="fas fa-eye"></i> View Details
                      </button>
                      <button class="btn btn-outline-primary btn-sm" onclick="openEditModal(this)" data-id="{{ medicine.medicine.id }}" data-medicine_name="{{ medicine.medicine.medicine_name|tojson }}" data-name="{{ medicine.medicine.name|tojson }}" data-type="{{ medicine.medicine.type|tojson }}" data-age_group="{{ medicine.medicine.age_group|tojson }}" data-category="{{ medicine.medicine.category|tojson }}" data-price="{{ medicine.medicine.price }}" data-discount="{{ medicine.medicine.discount }}" data-stock="{{ medicine.medicine.stock }}" data-description="{{ medicine.medicine.description|tojson }}">
                        <i class="fas fa-edit"></i> Edit
                      </button>
                      <form method="POST" action="{{ url_for('admin.delete_medicine', med_id=medicine.medicine.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Are you sure you want to delete this medicine?')">
                          <i class="fas fa-trash"></i> Delete
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
        <div class="row">

      <!-- Orders Tab -->
      <div class="tab-pane fade" id="orders" role="tabpanel">
        <div class="search-box">
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" class="form-control" placeholder="Search orders..." id="orderSearch">
            <select class="form-select" id="orderStatusFilter">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="processing">Processing</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
            </select>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-modern" id="ordersTable">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Total</th>
                <th>Status</th>
                <th>Date</th>
                <th>OTP Verification</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
              <tr>
                <td>#{{ order.id }}</td>
                <td>{{ order.user.email }}</td>
                <td>₹{{ "%.2f"|format(order.total or 0) }}</td>
                <td>
                  <span class="badge {% if order.status == 'delivered' %}bg-success{% elif order.status == 'shipped' %}bg-info{% elif order.status == 'processing' %}bg-warning{% else %}bg-secondary{% endif %}">
                    {{ order.status.title() }}
                  </span>
                </td>
                <td>{{ order.ordered_at.strftime('%Y-%m-%d') }}</td>
                <td>
                  {% if order.delivery_otp and order.status != 'Delivered' %}
                    <form method="POST" action="{{ url_for('admin.verify_delivery_otp', order_id=order.id) }}" style="display: inline;">
                      <div class="input-group input-group-sm" style="width: 150px;">
                        <input type="text" name="otp" class="form-control" placeholder="Enter OTP" maxlength="6" required>
                        <button type="submit" class="btn btn-success btn-sm">Verify</button>
                      </div>
                    </form>
                  {% elif order.status == 'Delivered' %}
                    <span class="badge bg-success">Verified</span>
                  {% else %}
                    <span class="badge bg-warning">Not Sent</span>
                  {% endif %}
                </td>
                <td>
                  <div class="btn-group" role="group">
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="openViewOrderModal(this)"
                      data-order-id="{{ order.id }}"
                      data-customer="{{ order.user.email if order.user else '' }}"
                      data-total="{{ order.total or 0 }}"
                      data-status="{{ order.status or '' }}"
                      data-date="{{ order.ordered_at.strftime('%Y-%m-%d') if order.ordered_at else '' }}"
                      data-address="{{ order.address or 'N/A' }}"
                      data-medicine-name="{{ order.medicine.name if order.medicine else 'N/A' }}"
                      data-medicine-image="{{ order.medicine.image if order.medicine else '' }}"
                      data-medicine-price="{{ order.medicine.price if order.medicine else 0 }}"
                      data-discount="{{ order.medicine.discount if order.medicine else 0 }}"
                      data-quantity="{{ order.quantity if order.quantity else 1 }}"
                      title="View Order Details">
                      <i class="fas fa-eye"></i> View Details
                    </button>
                    <div class="dropdown">
                      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-cogs"></i> Actions
                      </button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="updateOrderStatus({{ order.id }}, 'Processing')"><i class="fas fa-play text-warning"></i> Mark Processing</a></li>
                        <li><a class="dropdown-item" href="#" onclick="updateOrderStatus({{ order.id }}, 'Shipped')"><i class="fas fa-truck text-info"></i> Mark Shipped</a></li>
                        <li><a class="dropdown-item" href="#" onclick="updateOrderStatus({{ order.id }}, 'Delivered')"><i class="fas fa-check-circle text-success"></i> Mark Delivered</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="updateOrderStatus({{ order.id }}, 'Rejected')"><i class="fas fa-times"></i> Reject Order</a></li>
                      </ul>
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Offers Tab -->
      <div class="tab-pane fade" id="offers" role="tabpanel">
        <div class="row">
          <div class="col-lg-6">
            <div class="form-card">
              <h5 class="mb-4"><i class="fas fa-tags text-warning"></i> Create New Offer</h5>
              <form method="POST" action="{{ url_for('admin.admin_dashboard') }}">
                <input type="hidden" name="add_offer" value="1">
                <div class="mb-3">
                  <label class="form-label">Offer Title</label>
                  <input type="text" name="title" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Description</label>
                  <textarea name="description" class="form-control" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Discount (%)</label>
                  <input type="number" name="discount" class="form-control" min="0" max="100" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Valid Until</label>
                  <input type="date" name="valid_until" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-warning btn-modern">Create Offer</button>
              </form>
            </div>
          </div>
          <div class="col-lg-6">
            <h5 class="mb-4"><i class="fas fa-gift text-danger"></i> Active Offers</h5>
            <div class="row">
              {% for offer in offers %}
              <div class="col-md-6 mb-3">
                <div class="card offer-card h-100">
                  <div class="card-body text-center">
                    <h6 class="card-title">{{ offer.title }}</h6>
                    <p class="card-text">{{ offer.description }}</p>
                    <div class="display-6 font-weight-bold">{{ offer.discount }}% OFF</div>
                    <small>Valid until {{ offer.valid_until.strftime('%b %d, %Y') }}</small>
                    <br>
                    <button class="btn btn-light btn-sm mt-2" onclick='openEditOfferModal({{ offer.id }}, {{ offer.title|tojson }}, {{ offer.description|tojson }}, {{ offer.discount }}, {{ offer.valid_until.strftime('%Y-%m-%d')|tojson }})'>Edit</button>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <!-- Prescriptions Tab -->
      <div class="tab-pane fade" id="prescriptions" role="tabpanel">
        <div class="search-box">
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" class="form-control" placeholder="Search prescriptions..." id="prescriptionSearch">
            <select class="form-select" id="prescriptionStatusFilter">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
              <option value="processing">Processing</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
            </select>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-modern" id="prescriptionsTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Patient</th>
                <th>Address</th>
                <th>Doctor</th>
                <th>Status</th>
                <th>Doctor Notes</th>
                <th>Date</th>
                <th>OTP Verification</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for prescription in prescriptions %}
              <tr>
                <td>#{{ prescription.id }}</td>
                <td>{{ prescription.user.email }}</td>
                <td>{{ prescription.doctor.email if prescription.doctor else 'N/A' }}</td>
                <td>
                  {% if prescription.status == 'Approved' %}
                  <span class="badge bg-success"><i class="fas fa-check"></i> Approved</span>
                  {% elif prescription.status == 'Rejected' %}
                  <span class="badge bg-danger"><i class="fas fa-times"></i> Rejected</span>
                  {% elif prescription.status == 'Doctor Approved' %}
                  <span class="badge bg-info"><i class="fas fa-user-md"></i> Doctor Approved</span>
                  {% elif prescription.status == 'pending' %}
                  <span class="badge bg-warning"><i class="fas fa-clock"></i> Pending</span>
                  {% else %}
                  <span class="badge bg-secondary">{{ prescription.status }}</span>
                  {% endif %}
                </td>
                <td>{{ prescription.submitted_at.strftime('%Y-%m-%d') }}</td>
                <td>
                  {% if prescription.delivery_otp and prescription.status != 'Delivered' %}
                    <form method="POST" action="{{ url_for('admin.verify_prescription_delivery_otp', prescription_id=prescription.id) }}" style="display: inline;">
                      <div class="input-group input-group-sm" style="width: 150px;">
                        <input type="text" name="otp" class="form-control" placeholder="Enter OTP" maxlength="6" required>
                        <button type="submit" class="btn btn-success btn-sm">Verify</button>
                      </div>
                    </form>
                  {% elif prescription.status == 'Delivered' %}
                    <span class="badge bg-success">Verified</span>
                  {% else %}
                    <span class="badge bg-warning">Not Sent</span>
                  {% endif %}
                </td>
                <td>
                  <form id="approveForm{{ prescription.id }}" method="POST" action="{{ url_for('admin.admin_verify', prescription_id=prescription.id) }}" style="display:none;">
                    <input type="hidden" name="action" value="approve">
                  </form>
                  <form id="rejectForm{{ prescription.id }}" method="POST" action="{{ url_for('admin.admin_verify', prescription_id=prescription.id) }}" style="display:none;">
                    <input type="hidden" name="action" value="reject">
                  </form>
                  <div class="btn-group" role="group">
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="viewPrescription(this)" data-src="/static/uploads/{{ prescription.file_path }}" data-id="{{ prescription.id }}" data-disease="{{ (prescription.disease or 'N/A')|tojson }}" data-symptoms="{{ (prescription.symptoms or 'N/A')|tojson }}" data-medicine="{{ (prescription.medicine or 'N/A')|tojson }}" data-address="{{ (prescription.user.address or 'N/A')|tojson }}" data-submitted="{{ prescription.submitted_at.strftime('%b %d, %Y %H:%M')|tojson }}" data-status="{{ prescription.status|tojson }}" data-doctor-notes="{{ (prescription.doctor_notes or 'N/A')|tojson }}" data-reviewed-at="{{ (prescription.reviewed_at.strftime('%b %d, %Y %H:%M') if prescription.reviewed_at else 'N/A')|tojson }}">
                      <i class="fas fa-eye"></i> View Details
                    </button>
                    <div class="dropdown">
                      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-cogs"></i> Actions
                      </button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="document.getElementById('approveForm{{ prescription.id }}').submit()"><i class="fas fa-check text-success"></i> Approve</a></li>
                        <li><a class="dropdown-item" href="#" onclick="document.getElementById('rejectForm{{ prescription.id }}').submit()"><i class="fas fa-times text-danger"></i> Reject</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="updatePrescriptionStatus({{ prescription.id }})"><i class="fas fa-edit"></i> Update Status</a></li>
                      </ul>
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>

      <!-- Users Tab -->
      <div class="tab-pane fade" id="users" role="tabpanel">
        <div class="row">
          <div class="col-lg-12">
            <h5 class="mb-4"><i class="fas fa-users text-primary"></i> Registered Users</h5>
            <div class="search-box">
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" class="form-control" placeholder="Search users..." id="userSearch">
              </div>
            </div>
            <div class="table-responsive">
              <table class="table table-modern" id="usersTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Verified</th>
                    <th>Registered At</th>
                  </tr>
                </thead>
                <tbody>
                  {% for user in users %}
                  <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>
                      {% if user.is_verified %}
                      <span class="badge bg-success">Verified</span>
                      {% else %}
                      <span class="badge bg-warning">Not Verified</span>
                      {% endif %}
                    </td>
                    <td>{{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Medicine Modal -->
<div class="modal fade" id="editMedicineModal" tabindex="-1" aria-labelledby="editMedicineModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editMedicineModalLabel">Edit Medicine</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="editMedicineForm" method="POST" action="" enctype="multipart/form-data">
        <div class="modal-body">
          <input type="hidden" name="id" id="editMedicineId">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Medicine Name</label>
              <input type="text" name="medicine_name" id="editMedicineName" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Brand Name</label>
              <input type="text" name="name" id="editName" class="form-control" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Type</label>
              <input type="text" name="type" id="editType" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Age Group</label>
              <input type="text" name="age_group" id="editAgeGroup" class="form-control" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Category</label>
              <select name="category" id="editCategory" class="form-control" required>
                <option value="">Select Category</option>
                <option value="Allopathy">Allopathy</option>
                <option value="Ayurvedic">Ayurvedic</option>
                <option value="Homeopathy">Homeopathy</option>
                <option value="Beauty">Beauty</option>
                <option value="Skin & Hair Care">Skin & Hair Care</option>
                <option value="Baby Care">Baby Care</option>
                <option value="Diabetes Care">Diabetes Care</option>
                <option value="Cardiac Care">Cardiac Care</option>
                <option value="Liver Care">Liver Care</option>
                <option value="Respiratory">Respiratory</option>
                <option value="Supplements">Supplements</option>
                <option value="Fitness & Wellness">Fitness & Wellness</option>
                <option value="Women's Health">Women's Health</option>
                <option value="Men's Health">Men's Health</option>
                <option value="Oral Care">Oral Care</option>
                <option value="Personal Hygiene">Personal Hygiene</option>
                <option value="Pain Relief">Pain Relief</option>
                <option value="ENT Care">ENT Care</option>
                <option value="First Aid">First Aid</option>
                <option value="Surgical Supplies">Surgical Supplies</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Price (₹)</label>
              <input type="number" step="0.01" name="price" id="editPrice" class="form-control" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Discount (%)</label>
              <input type="number" name="discount" id="editDiscount" class="form-control" min="0" max="100">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Stock</label>
              <input type="number" name="stock" id="editStock" class="form-control" required>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Image</label>
            <input type="file" name="image" id="editImage" class="form-control" accept="image/*">
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" id="editDescription" class="form-control" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- View Medicine Modal -->
<div class="modal fade" id="viewMedicineModal" tabindex="-1" aria-labelledby="viewMedicineModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" style="border-radius: 15px; overflow: hidden;">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="viewMedicineModalLabel">
          <i class="fas fa-pills me-2"></i>Medicine Details
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <div class="row">
          <div class="col-md-4 text-center mb-4">
            <div class="position-relative">
              <img id="viewMedicineImage" src="" alt="Medicine Image" class="img-fluid rounded shadow-lg" style="max-height: 250px; object-fit: cover; border: 3px solid #e9ecef;">
              <div class="mt-3">
                <span id="viewStockBadge" class="badge fs-6 px-3 py-2"></span>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card border-0 shadow-sm mb-4">
              <div class="card-body">
                <h6 class="text-primary fw-bold mb-3">
                  <i class="fas fa-info-circle me-2"></i>Basic Information
                </h6>
                <div class="row mb-3">
                  <div class="col-6">
                    <strong class="text-muted small">MEDICINE NAME</strong>
                    <p id="viewMedicineName" class="mb-0 fw-semibold text-dark"></p>
                  </div>
                  <div class="col-6">
                    <strong class="text-muted small">BRAND NAME</strong>
                    <p id="viewName" class="mb-0 fw-semibold text-dark"></p>
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-6">
                    <strong class="text-muted small">TYPE</strong>
                    <p id="viewType" class="mb-0">
                      <span class="badge bg-light text-dark px-3 py-1"></span>
                    </p>
                  </div>
                  <div class="col-6">
                    <strong class="text-muted small">AGE GROUP</strong>
                    <p id="viewAgeGroup" class="mb-0">
                      <span class="badge bg-light text-dark px-3 py-1"></span>
                    </p>
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-6">
                    <strong class="text-muted small">CATEGORY</strong>
                    <p id="viewCategory" class="mb-0">
                      <span class="badge bg-info px-3 py-1"></span>
                    </p>
                  </div>
                  <div class="col-6">
                    <strong class="text-muted small">STOCK STATUS</strong>
                    <p id="viewStockStatus" class="mb-0 fw-semibold"></p>
                  </div>
                </div>
              </div>
            </div>

            <div class="card border-0 shadow-sm mb-4">
              <div class="card-body">
                <h6 class="text-success fw-bold mb-3">
                  <i class="fas fa-tags me-2"></i>Pricing Information
                </h6>
                <div class="row">
                  <div class="col-6">
                    <strong class="text-muted small">ORIGINAL PRICE</strong>
                    <p id="viewOriginalPrice" class="mb-0 text-muted text-decoration-line-through"></p>
                  </div>
                  <div class="col-6">
                    <strong class="text-muted small">CURRENT PRICE</strong>
                    <p id="viewPrice" class="mb-0 text-success fw-bold fs-5"></p>
                  </div>
                </div>
                <div class="mt-2">
                  <strong class="text-muted small">DISCOUNT</strong>
                  <p id="viewDiscount" class="mb-0 text-warning fw-bold"></p>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-body">
                    <h6 class="text-info fw-bold mb-3">
                      <i class="fas fa-list me-2"></i>Description
                    </h6>
                    <p id="viewDescription" class="text-secondary small mb-0" style="line-height: 1.5;"></p>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-body">
                    <h6 class="text-warning fw-bold mb-3">
                      <i class="fas fa-flask me-2"></i>Ingredients
                    </h6>
                    <p id="viewIngredients" class="text-secondary small mb-0" style="line-height: 1.5;"></p>
                  </div>
                </div>
              </div>
            </div>

            <div class="card border-0 shadow-sm mt-4">
              <div class="card-body">
                <h6 class="text-danger fw-bold mb-3">
                  <i class="fas fa-exclamation-triangle me-2"></i>Usage Instructions
                </h6>
                <p id="viewUsage" class="text-secondary small mb-0" style="line-height: 1.5;"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-outline-primary" onclick="openEditModal(document.querySelector('[data-id=\"' + document.getElementById('viewMedicineModal').getAttribute('data-current-id') + '\"]'))" data-bs-dismiss="modal">
          <i class="fas fa-edit me-2"></i>Edit Medicine
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-2"></i>Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- View Prescription Modal -->
<div class="modal fade" id="viewPrescriptionModal" tabindex="-1" aria-labelledby="viewPrescriptionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewPrescriptionModalLabel">Prescription Image</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <img id="prescriptionImage" src="" alt="Prescription" style="max-width: 100%; max-height: 500px;">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Back to Page</button>
      </div>
    </div>
  </div>
</div>

<!-- View Order Modal -->
<div class="modal fade" id="viewOrderModal" tabindex="-1" aria-labelledby="viewOrderModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewOrderModalLabel">Order Details - <span id="orderId"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <h6 class="mb-3">Medicine Details</h6>
            <img id="orderMedicineImage" src="" alt="Medicine Image" class="img-fluid rounded shadow mb-3" style="max-height: 200px; object-fit: cover;">
            <p class="mb-2"><strong>Name:</strong> <span id="orderMedicineName" class="fw-semibold"></span></p>
            <p class="mb-2"><strong>Price:</strong> <span id="orderMedicinePrice" class="text-success fw-bold"></span></p>
            <p class="mb-0"><strong>Quantity (Cart):</strong> <span id="orderQuantity" class="fw-semibold"></span></p>
          </div>
          <div class="col-md-6">
            <h6 class="mb-3">Order Information</h6>
            <p class="mb-2"><strong>Customer:</strong> <span id="orderCustomer" class="fw-semibold"></span></p>
            <p class="mb-2"><strong>Address:</strong> <span id="orderAddress" class="text-muted"></span></p>
            <p class="mb-2"><strong>Total:</strong> <span id="orderTotal" class="text-success fw-bold"></span></p>
            <p class="mb-2"><strong>Status:</strong> <span id="orderStatus" class="badge"></span></p>
            <p class="mb-0"><strong>Date:</strong> <span id="orderDate" class="text-muted"></span></p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Offer Modal -->
<div class="modal fade" id="editOfferModal" tabindex="-1" aria-labelledby="editOfferModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editOfferModalLabel">Edit Offer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="editOfferForm" method="POST" action="">
        <div class="modal-body">
          <input type="hidden" name="id" id="editOfferId">
          <div class="mb-3">
            <label class="form-label">Offer Title</label>
            <input type="text" name="title" id="editOfferTitle" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" id="editOfferDescription" class="form-control" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Discount (%)</label>
            <input type="number" name="discount" id="editOfferDiscount" class="form-control" min="0" max="100" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Valid Until</label>
            <input type="date" name="valid_until" id="editOfferValidUntil" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Charts JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Sales Chart
  const salesCtx = document.getElementById('salesChart').getContext('2d');
  const salesData = {{ sales_data | tojson }};
  const salesLabels = {{ status_labels | tojson }};
  const salesChart = new Chart(salesCtx, {
    type: 'bar',
    data: {
      labels: salesLabels,
      datasets: [{
        label: 'Sales (₹)',
        data: salesData,
        backgroundColor: ['#ffc107', '#17a2b8', '#6f42c1', '#28a745', '#dc3545', '#fd7e14', '#20c997', '#e83e8c'],
        borderColor: ['#ffc107', '#17a2b8', '#6f42c1', '#28a745', '#dc3545', '#fd7e14', '#20c997', '#e83e8c'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // Order Status Chart
  const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
  const orderData = {{ order_counts | tojson }};
  const orderStatusChart = new Chart(orderStatusCtx, {
    type: 'doughnut',
    data: {
      labels: salesLabels,
      datasets: [{
        data: orderData,
        backgroundColor: ['#ffc107', '#17a2b8', '#6f42c1', '#28a745', '#dc3545', '#fd7e14', '#20c997', '#e83e8c']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
        }
      }
    }
  });

  // Medicine filtering and sorting functionality
  function filterMedicines() {
    const searchFilter = document.getElementById('medicineSearch').value.toLowerCase();
    const categoryFilter = document.getElementById('categoryFilter').value;
    const stockFilter = document.getElementById('stockFilter').value;
    const sortBy = document.getElementById('sortBy').value;

    const cards = document.querySelectorAll('#medicinesGrid .medicine-item');
    const cardsArray = Array.from(cards);

    // Filter cards
    cardsArray.forEach(card => {
      const name = card.querySelector('.card-title').textContent.toLowerCase();
      const description = card.querySelector('.card-text').textContent.toLowerCase();
      const category = card.getAttribute('data-category');
      const stock = parseInt(card.getAttribute('data-stock'));

      let matchesSearch = !searchFilter || name.includes(searchFilter) || description.includes(searchFilter);
      let matchesCategory = !categoryFilter || category === categoryFilter;
      let matchesStock = true;

      if (stockFilter === 'in-stock') {
        matchesStock = stock > 10;
      } else if (stockFilter === 'low-stock') {
        matchesStock = stock > 0 && stock <= 10;
      } else if (stockFilter === 'out-of-stock') {
        matchesStock = stock === 0;
      }

      card.style.display = matchesSearch && matchesCategory && matchesStock ? '' : 'none';
    });

    // Sort visible cards
    const visibleCards = cardsArray.filter(card => card.style.display !== 'none');
    visibleCards.sort((a, b) => {
      let aValue, bValue;

      switch (sortBy) {
        case 'name':
          aValue = a.querySelector('.card-title').textContent.toLowerCase();
          bValue = b.querySelector('.card-title').textContent.toLowerCase();
          return aValue.localeCompare(bValue);
        case 'price':
          aValue = parseFloat(a.getAttribute('data-price'));
          bValue = parseFloat(b.getAttribute('data-price'));
          return aValue - bValue;
        case 'stock':
          aValue = parseInt(a.getAttribute('data-stock'));
          bValue = parseInt(b.getAttribute('data-stock'));
          return bValue - aValue; // Higher stock first
        case 'category':
          aValue = a.getAttribute('data-category');
          bValue = b.getAttribute('data-category');
          return aValue.localeCompare(bValue);
        default:
          return 0;
      }
    });

    // Reorder DOM elements
    const container = document.getElementById('medicinesGrid');
    visibleCards.forEach(card => container.appendChild(card));
  }

  // Event listeners for filters and sorting
  document.getElementById('medicineSearch').addEventListener('keyup', filterMedicines);
  document.getElementById('categoryFilter').addEventListener('change', filterMedicines);
  document.getElementById('stockFilter').addEventListener('change', filterMedicines);
  document.getElementById('sortBy').addEventListener('change', filterMedicines);

  // Bulk actions functionality
  function toggleBulkActions() {
    const checkboxes = document.querySelectorAll('.medicine-checkbox:checked');
    const bulkActions = document.getElementById('bulkActions');
    const selectedCount = document.getElementById('selectedCount');

    if (checkboxes.length > 0) {
      bulkActions.style.display = 'flex';
      selectedCount.textContent = `${checkboxes.length} medicine${checkboxes.length > 1 ? 's' : ''} selected`;
    } else {
      bulkActions.style.display = 'none';
    }
  }

  function bulkDelete() {
    const checkboxes = document.querySelectorAll('.medicine-checkbox:checked');
    if (checkboxes.length === 0) return;

    if (confirm(`Are you sure you want to delete ${checkboxes.length} medicine${checkboxes.length > 1 ? 's' : ''}?`)) {
      const ids = Array.from(checkboxes).map(cb => cb.closest('.medicine-item').querySelector('[data-id]').getAttribute('data-id'));
      // Create a form to submit the delete request
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '{{ url_for("admin.bulk_delete_medicines") }}';

      ids.forEach(id => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'medicine_ids';
        input.value = id;
        form.appendChild(input);
      });

      document.body.appendChild(form);
      form.submit();
    }
  }

  function bulkExport() {
    const checkboxes = document.querySelectorAll('.medicine-checkbox:checked');
    if (checkboxes.length === 0) return;

    const ids = Array.from(checkboxes).map(cb => cb.closest('.medicine-item').querySelector('[data-id]').getAttribute('data-id'));
    const url = '{{ url_for("admin.export_medicines") }}?' + ids.map(id => `ids=${id}`).join('&');
    window.open(url, '_blank');
  }

  // Attach bulk actions to checkboxes
  document.addEventListener('change', function(e) {
    if (e.target.classList.contains('medicine-checkbox')) {
      toggleBulkActions();
    }
  });

  document.getElementById('orderSearch').addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll('#ordersTable tbody tr');
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    });
  });

  document.getElementById('orderStatusFilter').addEventListener('change', function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll('#ordersTable tbody tr');
    rows.forEach(row => {
      const status = row.querySelector('.badge').textContent.toLowerCase();
      row.style.display = !filter || status.includes(filter) ? '' : 'none';
    });
  });

  // Edit Medicine Modal
  function openEditModal(button) {
    const data = button.dataset;
    document.getElementById('editMedicineId').value = data.id;
    document.getElementById('editMedicineName').value = data.medicine_name;
    document.getElementById('editName').value = data.name;
    document.getElementById('editType').value = data.type;
    document.getElementById('editAgeGroup').value = data.age_group;
    document.getElementById('editCategory').value = data.category;
    document.getElementById('editPrice').value = data.price;
    document.getElementById('editDiscount').value = data.discount;
    document.getElementById('editStock').value = data.stock;
    document.getElementById('editDescription').value = data.description;
    document.getElementById('editMedicineForm').action = '/admin/edit_medicine/' + data.id;
    new bootstrap.Modal(document.getElementById('editMedicineModal')).show();
  }

  // View Medicine Modal
  function openViewModal(button) {
    const data = button.dataset;
    document.getElementById('viewMedicineImage').src = data.image;
    document.getElementById('viewMedicineName').textContent = data.medicine_name;
    document.getElementById('viewName').textContent = data.name;
    document.getElementById('viewType').textContent = data.type;
    document.getElementById('viewAgeGroup').textContent = data.age_group;
    document.getElementById('viewCategory').textContent = data.category;
    document.getElementById('viewPrice').textContent = '₹' + parseFloat(data.price).toFixed(2);
    document.getElementById('viewDiscount').textContent = data.discount + '%';
    document.getElementById('viewStock').textContent = data.stock + ' units';
    document.getElementById('viewDescription').textContent = data.description;
    new bootstrap.Modal(document.getElementById('viewMedicineModal')).show();
  }

  // View Order Modal
  function openViewOrderModal(button) {
    const data = button.dataset;
    document.getElementById('orderId').textContent = data.orderId;
    const imgSrc = data.medicineImage || '/static/uploads/default.png';
    document.getElementById('orderMedicineImage').src = imgSrc;
    document.getElementById('orderMedicineName').textContent = data.medicineName;
    const originalPrice = parseFloat(data.medicinePrice);
    const discount = parseFloat(data.discount || 0);
    const discountedPrice = originalPrice * (1 - discount / 100);
    let priceHtml = '';
    if (discount > 0) {
      priceHtml = '<span class="fw-semibold text-muted text-decoration-line-through">₹' + originalPrice.toFixed(2) + '</span><br><span class="fw-semibold text-success">₹' + discountedPrice.toFixed(2) + '</span>';
    } else {
      priceHtml = '<span class="fw-semibold text-success">₹' + originalPrice.toFixed(2) + '</span>';
    }
    document.getElementById('orderMedicinePrice').innerHTML = priceHtml;
    document.getElementById('orderQuantity').textContent = data.quantity;
    document.getElementById('orderCustomer').textContent = data.customer;
    document.getElementById('orderAddress').textContent = data.address || 'N/A';
    document.getElementById('orderTotal').textContent = '₹' + parseFloat(data.total).toFixed(2);
    const statusEl = document.getElementById('orderStatus');
    statusEl.textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
    let statusClass = 'badge bg-secondary';
    if (data.status === 'delivered') {
      statusClass = 'badge bg-success';
    } else if (data.status === 'shipped') {
      statusClass = 'badge bg-info';
    } else if (data.status === 'processing') {
      statusClass = 'badge bg-warning';
    }
    statusEl.className = statusClass;
    document.getElementById('orderDate').textContent = data.date;
    new bootstrap.Modal(document.getElementById('viewOrderModal')).show();
  }

  // Legacy viewOrder for compatibility
  function viewOrder(id) {
    const button = document.querySelector(`button[data-order-id="${id}"]`);
    if (button) {
      openViewOrderModal(button);
    } else {
      window.location.href = '/admin/order/' + id;
    }
  }

  // Update Order Status
  function updateOrderStatus(id, status) {
    if (status === undefined) {
      status = prompt('Enter new status (pending, processing, shipped, delivered):');
    }
    if (status) {
      window.location.href = '/admin/update_order_status/' + id + '?status=' + status;
    }
  }

  // Update Prescription Status
  function updatePrescriptionStatus(id) {
    const status = prompt('Enter new status (pending, processing, shipped, delivered):');
    if (status) {
      window.location.href = '/admin/update_prescription_status/' + id + '?status=' + status;
    }
  }

  // Edit Offer Modal
  function openEditOfferModal(id, title, description, discount, validUntil) {
    document.getElementById('editOfferId').value = id;
    document.getElementById('editOfferTitle').value = title;
    document.getElementById('editOfferDescription').value = description;
    document.getElementById('editOfferDiscount').value = discount;
    document.getElementById('editOfferValidUntil').value = validUntil;
    document.getElementById('editOfferForm').action = '/admin/edit_offer/' + id;
    new bootstrap.Modal(document.getElementById('editOfferModal')).show();
  }

  // Prescription search functionality
  document.getElementById('prescriptionSearch').addEventListener('keyup', filterPrescriptions);
  document.getElementById('prescriptionStatusFilter').addEventListener('change', filterPrescriptions);

  function filterPrescriptions() {
    const searchFilter = document.getElementById('prescriptionSearch').value.toLowerCase();
    const statusFilter = document.getElementById('prescriptionStatusFilter').value.toLowerCase();

    const rows = document.querySelectorAll('#prescriptionsTable tbody tr');
    rows.forEach(row => {
      const patient = row.cells[1].textContent.toLowerCase();
      const address = row.cells[2].textContent.toLowerCase();
      const doctor = row.cells[3].textContent.toLowerCase();
      const status = row.cells[6].textContent.toLowerCase();
      const date = row.cells[7].textContent.toLowerCase();

      const matchesSearch = !searchFilter || patient.includes(searchFilter) || address.includes(searchFilter) || doctor.includes(searchFilter) || date.includes(searchFilter);
      const matchesStatus = !statusFilter || status.includes(statusFilter);

      row.style.display = matchesSearch && matchesStatus ? '' : 'none';
    });
  }

  // User search functionality
  document.getElementById('userSearch').addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll('#usersTable tbody tr');
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    });
  });

  // Export functions
  function exportCSV() {
    const table = document.querySelector('#prescriptionsTable');
    let csv = [];
    const rows = table.querySelectorAll('tr');

    for (let i = 0; i < rows.length; i++) {
      const row = [], cols = rows[i].querySelectorAll('td, th');

      for (let j = 0; j < cols.length; j++) {
        row.push('"' + cols[j].innerText.replace(/"/g, '""') + '"');
      }

      csv.push(row.join(','));
    }

    const csvContent = csv.join('\n');
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    if (link.download !== undefined) {
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', 'prescriptions.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  }

  function exportPDF() {
    window.location.href = '/admin/export_prescriptions_pdf';
  }

  // View Prescription
  function viewPrescription(element) {
    const src = element.getAttribute('data-src') || element.src;
    document.getElementById('prescriptionImage').src = src;
    new bootstrap.Modal(document.getElementById('viewPrescriptionModal')).show();
  }
</script>
{% endblock %}
