{% extends 'base.html' %}
{% block content %}

<!-- üîç Search Bar -->
<div class="row align-items-center my-4">
  <div class="col-md-8 mx-auto">
    <form method="GET" class="input-group">
      <input type="text" name="search" class="form-control" placeholder="üîç Search for medicines..." value="{{ request.args.get('search', '') }}">
      <button class="btn btn-outline-primary" type="submit">Search</button>
    </form>
  </div>
</div>

<!-- üóÇÔ∏è Shop By Category with 3D Tilt -->
 <h4 class="mb-3 text-primary fw-bold">üóÇÔ∏è Shop By Category</h4>
<div class="mb-3">
  <div class="row row-cols-auto g-2 justify-content-center">
    <div class="col">
      <a href="{{ url_for('main.home', category='Allopathy') }}" class="btn btn-outline-primary btn-sm">Allopathy</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Ayurvedic') }}" class="btn btn-outline-primary btn-sm">Ayurvedic</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Homeopathy') }}" class="btn btn-outline-primary btn-sm">Homeopathy</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Beauty') }}" class="btn btn-outline-primary btn-sm">Beauty</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Skin & Hair Care') }}" class="btn btn-outline-primary btn-sm">Skin & Hair Care</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Baby Care') }}" class="btn btn-outline-primary btn-sm">Baby Care</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Diabetes Care') }}" class="btn btn-outline-primary btn-sm">Diabetes Care</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Cardiac Care') }}" class="btn btn-outline-primary btn-sm">Cardiac Care</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Liver Care') }}" class="btn btn-outline-primary btn-sm">Liver Care</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Respiratory') }}" class="btn btn-outline-primary btn-sm">Respiratory</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Supplements') }}" class="btn btn-outline-primary btn-sm">Supplements</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Fitness & Wellness') }}" class="btn btn-outline-primary btn-sm">Fitness & Wellness</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Women\'s Health') }}" class="btn btn-outline-primary btn-sm">Women's Health</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Men\'s Health') }}" class="btn btn-outline-primary btn-sm">Men's Health</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Oral Care') }}" class="btn btn-outline-primary btn-sm">Oral Care</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Personal Hygiene') }}" class="btn btn-outline-primary btn-sm">Personal Hygiene</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Pain Relief') }}" class="btn btn-outline-primary btn-sm">Pain Relief</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='ENT Care') }}" class="btn btn-outline-primary btn-sm">ENT Care</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='First Aid') }}" class="btn btn-outline-primary btn-sm">First Aid</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home', category='Surgical Supplies') }}" class="btn btn-outline-primary btn-sm">Surgical Supplies</a>
    </div>
    <div class="col">
      <a href="{{ url_for('main.home') }}" class="btn btn-outline-secondary btn-sm">All Categories</a>
    </div>
  </div>
</div>


<!-- üéâ Special Offers -->
{% if offers %}
<h4 class="mt-5 mb-3 text-primary fw-bold">üéâ Special Offers</h4>
<div class="row">
  {% for offer in offers[:2] %}
  <div class="col-6 mb-3">
    <div class="card offer-card h-100">
      <div class="card-body text-center">
        <h6 class="card-title">{{ offer.title }}</h6>
        <p class="card-text">{{ offer.description }}</p>
        <div class="display-6 font-weight-bold">{{ offer.discount }}% OFF</div>
        <small>Valid until {{ offer.valid_until.strftime('%b %d, %Y') }}</small>
        <br>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- üíä Medicines Section with 3D Tilt -->
<h4 class="mt-5 mb-3 text-primary">üíä Available Medicines</h4>
<div class="alert alert-info">
  <strong>Track Your Orders:</strong> Visit "My Orders" to see real-time status updates and tracking information for your prescriptions and medicines.
</div>
<div class="row g-4">
  {% for med in medicines %}
  <div class="col-6">
    <div class="card tilt shadow-sm h-100 medicine-card">
      <div class="position-relative">
        <img src="{{ med.image }}" class="card-img-top p-3" alt="{{ med.name }}" style="height: 180px; object-fit: contain;">
        {% if med.discount %}
          <span class="badge bg-danger position-absolute top-0 start-0">{{ med.discount }}% OFF</span>
        {% endif %}
      </div>
      <div class="card-body d-flex flex-column">
        <h5 class="card-title mb-1">{{ med.name }}</h5>
        <p class="mb-1 text-muted small">{{ med.medicine_name }}</p>
        <p class="mb-1">
          <strong>Category:</strong> {{ med.category }}<br>
          <strong>Type:</strong> {{ med.type }}<br>
          <strong>Age:</strong> {{ med.age_group }}
        </p>
        <p class="mb-1">
          {% if med.discount %}
            <del class="text-muted">‚Çπ{{ med.price }}</del> <strong class="text-success">‚Çπ{{ (med.price - (med.price * med.discount / 100)) | round(2) }}</strong>
          {% else %}
            <strong>‚Çπ{{ med.price }}</strong>
          {% endif %}
        </p>
        <p class="text-muted small mb-2">
          {{ med.description[:80] }}{% if med.description|length > 80 %}...{% endif %}
        </p>
        <p class="mb-2">
          {% if med.stock > 0 %}
            <span class="badge bg-success">In Stock ({{ med.stock }} available)</span>
          {% else %}
            <span class="badge bg-danger">Out of Stock</span>
          {% endif %}
        </p>

        <!-- Add to cart -->
        <form method="POST" action="{{ url_for('main.add_to_cart', med_id=med.id) }}" class="mt-auto">
          <div class="input-group">
            <input type="number" name="quantity" min="1" max="{{ med.stock }}" value="1" class="form-control form-control-sm">
            <button type="submit" class="btn btn-sm btn-outline-primary">üõí Add</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% if not medicines %}
<div class="alert alert-info mt-4">No medicines found matching your search.</div>
{% endif %}

<!-- ‚úÖ Tilt JS Script -->
<script>
  document.querySelectorAll('.tilt').forEach(card => {
    card.addEventListener('mousemove', e => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left - rect.width / 2;
      const y = e.clientY - rect.top - rect.height / 2;
      card.style.transform = `rotateX(${ -y / 20 }deg) rotateY(${ x / 20 }deg)`;
    });
    card.addEventListener('mouseleave', () => {
      card.style.transform = 'rotateX(0) rotateY(0)';
      card.style.transition = 'transform 0.3s ease';
    });
  });
</script>

<style>
  .card.tilt {
    transition: transform 0.2s ease-in-out;
    will-change: transform;
    border-radius: 1rem;
  }

  .offer-card {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    border: none;
    border-radius: 15px;
    color: white;
    transition: transform 0.3s ease;
  }

  .offer-card:hover {
    transform: translateY(-3px);
  }

  .medicine-card {
    transition: transform 0.3s ease;
  }

  .medicine-card:hover {
    transform: translateY(-5px);
  }

  .category-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 15px;
    color: white;
    transition: transform 0.3s ease;
  }

  .category-card:hover {
    transform: translateY(-3px);
  }
</style>

{% endblock %}